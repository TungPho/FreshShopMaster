@model FreshShopMaster.Models.ViewModels.ProductListViewModel
@{
	ViewData["Title"] = "Index";
}


<!-- Start Shop Page  -->
<div class="shop-box-inner">
	<div class="container">
		<div class="row" id="all-products">
			<div class="col-xl-9 col-lg-9 col-sm-12 col-xs-12 shop-content-right">
				<div class="right-product-box">
					<div class="product-item-filter row">
						<div class="col-12 col-sm-8 text-center text-sm-left">
							<div class="toolbar-sorter-right">
								<span>Sort by </span>

								<select id="basic" class="selectpicker show-tick form-control sort-type" data-placeholder="$ USD">
									<option data-display="Select"></option>
									<option value="1">Popularity</option>
									<option value="2">High Price → Low Price</option>
									<option value="3">Low Price → High Price</option>
									<option value="4">Best Selling</option>
								</select>
							</div>
							<p>Showing all @Model.Products.Count() results</p>
						</div>
						<div class="col-12 col-sm-4 text-center text-sm-right">
							<ul class="nav nav-tabs ml-auto">
								<li>
									<a class="nav-link active" href="#grid-view" data-toggle="tab"> <i class="fa fa-th"></i> </a>
								</li>
								<li>
									<a class="nav-link" href="#list-view" data-toggle="tab"> <i class="fa fa-list-ul"></i> </a>
								</li>
							</ul>
						</div>
					</div>
					<div class="product-categorie-box">
						<div class="tab-content">
							<div role="tabpanel" class="tab-pane fade show active" id="grid-view">
								<div class="row" id="sorted_products">

									@foreach (var item in Model?.Products)
									{
										<div class="col-sm-6 col-md-6 col-lg-4 col-xl-4 products">
											<div class="products-single fix">
												<div class="box-img-hover">
													<div class="type-lb">
														<p class="sale">Sale</p>
													</div>
													<img src="@item.ProductPhoto" class="img-fluid" alt="Image">
													<div class="mask-icon">
														<ul>
															<li><a href="/Products/Details/?id=@item.ProductId" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
															<li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
															<li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
														</ul>
														<a class="cart" href="/Cart/AddToCart/?productId=@item.ProductId">Add to Cart</a>
													</div>
												</div>
												<div class="why-text">
													<h4>@item.ProductName</h4>
													<h5>@item.ProductPrice</h5>
												</div>
											</div>
										</div>
									}


								</div>
								<a class="btn hvr-hover" href="#" aria-label="Previous">
									<span aria-hidden="true">&laquo;</span>
									<span class="sr-only">Previous</span>
								</a>
								<class ="root_paing">
									@for (int i = 1; i <= Model.PaingInfo.TotalPages + 1; i++)
									{
										@* <a class="btn hvr-hover paing_linked" href="/Products/Index/?page=@i">@i</a> *@
										<a class="btn hvr-hover paing_linked">@i</a>
									}

									</>
									<a class="btn hvr-hover" href="#" aria-label="Next">
										<span aria-hidden="true">&raquo;</span>
										<span class="sr-only">Next</span>
									</a>
							</div>
							<div role="tabpanel" class="tab-pane fade" id="list-view">

								@foreach (var item in Model.Products)
								{
									<div class="list-view-box">
										<div class="row">
											<div class="col-sm-6 col-md-6 col-lg-4 col-xl-4">
												<div class="products-single fix">
													<div class="box-img-hover">
														<div class="type-lb">
															<p class="sale">Sale</p>
														</div>
														<img src="@item.ProductPhoto" class="img-fluid" alt="Image">
														<div class="mask-icon">
															<ul>
																<li><a href="#" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
																<li><a href="#" data-toggle="tooltip" data-placement="right" title="Compare"><i class="fas fa-sync-alt"></i></a></li>
																<li><a href="#" data-toggle="tooltip" data-placement="right" title="Add to Wishlist"><i class="far fa-heart"></i></a></li>
															</ul>
														</div>
													</div>
												</div>
											</div>
											<div class="col-sm-6 col-md-6 col-lg-8 col-xl-8">
												<div class="why-text full-width">
													<h4>@item.ProductName</h4>
													<h5> <del>@item.ProductPrice</del></h5>>
													<p>
														@item.ProductDescription
													</p>
													<a class="btn hvr-hover" href="/Cart/AddToCart?productId=@item.ProductId">Add to Cart</a>
												</div>
											</div>
										</div>
									</div>
								}
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-xl-3 col-lg-3 col-sm-12 col-xs-12 sidebar-shop-left">
				<h5 class="font-weight-semi-bold mb-4">Filter by price</h5>
				<form id="price_filter_form">
					<div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
						<input type="checkbox" class="custom-control-input" val="all-price" checked id="price-all">
						<label class="custom-control-label" for="price-all">All Price</label>
						<span class="badge border font-weight-normal">1000</span>
					</div>
					<div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
						<input type="checkbox" class="custom-control-input" val="0-100" id="price-1">
						<label class="custom-control-label" for="price-1">$0 - $100</label>
						<span class="badge border font-weight-normal">150</span>
					</div>
					<div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
						<input type="checkbox" class="custom-control-input" val="100-200" id="price-2">
						<label class="custom-control-label" for="price-2">$100 - $200</label>
						<span class="badge border font-weight-normal">295</span>
					</div>
					<div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
						<input type="checkbox" class="custom-control-input" val="200-300" id="price-3">
						<label class="custom-control-label" for="price-3">$200 - $300</label>
						<span class="badge border font-weight-normal">246</span>
					</div>
					<div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
						<input type="checkbox" class="custom-control-input" val="300-400" id="price-4">
						<label class="custom-control-label" for="price-4">$300 - $400</label>
						<span class="badge border font-weight-normal">145</span>
					</div>
					<div class="custom-control custom-checkbox d-flex align-items-center justify-content-between">
						<input type="checkbox" class="custom-control-input" val="400-500" id="price-5">
						<label class="custom-control-label" for="price-5">$400 - $500</label>
						<span class="badge border font-weight-normal">168</span>
					</div>
				</form>
				<a class="btn hvr-hover filter">Filter</a>
			</div>
		</div>
	</div>
</div>
<!-- End Shop Page -->
@section Scripts{
	<script>
		let asyncFnSort = async function (url) {
			let response = await fetch(url);
			let data = await response.text();
			return data;
		}
		let displayData = function (data) {
			document.querySelector("#sorted_products").innerHTML = data;
		}

		let changeListener = async function () {
			let value = this.value;
			console.log(value);
			if (value == "1") {
				console.log("Popularity");

			} else if (value == "2") {
				console.log("High Price → Low Price");
				data = await asyncFnSort("/Products/SortByHighPrice");
				displayData(data);
			} else if (value == "3") {
				console.log("Low Price → High Price");
				data = await asyncFnSort("/Products/SortByLowPrice");
				displayData(data);
			} else if (value == "4") {
				console.log("Best Selling");
			}
		}
		//sort the price
		document.querySelector(".sort-type").onchange = changeListener;


		const filterBtn = document.querySelector(".filter");

		let getSelectedCheckBox = function () {
			let checkbox = $('#price_filter_form input[type="checkbox"]:checked');
			checkbox = Array.from(checkbox);
			let values = [];
			checkbox.forEach(box => {
				let val = box.getAttribute('val');
				values.push(val);
			})
			return values;
		}

		filterBtn.addEventListener('click', async function (e) {
			let priceRange = getSelectedCheckBox();
			console.log(priceRange);
			var data = {
				PriceRange: priceRange,
			}

			let res = await fetch("/Products/GetFilteredProducts", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(data)
			})
			console.log(res);
			let res2 = await res.text();
			console.log(res2);
			displayData(res2);

		})

		let pagingAsync = async function (page) {
			const res = await fetch(`https://localhost:7220/Products/Index/?page=${page}`);
			const data = await res.text();
			console.log(data);
			displayData(data);
		}

		let links = document.querySelectorAll('.paing_linked');
		links.forEach((link,index) => {
			if (Number(link.textContent) == 1) {
				link.setAttribute("href", "/Products/Index");
			}
			link.addEventListener('click', () => {
				pagingAsync(Number(link.textContent));
			}
			)
		})

		
		
	</script>

}


